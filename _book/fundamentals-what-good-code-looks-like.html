<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Fundamentals: What good code looks like | Good code practice</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Fundamentals: What good code looks like | Good code practice" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Fundamentals: What good code looks like | Good code practice" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Department for Education guidance" />


<meta name="date" content="2020-04-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="fundamentals-how-to-write-good-code.html"/>
<link rel="next" href="code-structure.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> The QA framework</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#writing-code-for-qa"><i class="fa fa-check"></i><b>1.1</b> Writing code for QA</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#our-approach-to-writing-and-updating-this-guidance"><i class="fa fa-check"></i><b>1.2</b> Our approach to writing and updating this guidance</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-fundamentals-of-writing-good-code.html"><a href="the-fundamentals-of-writing-good-code.html"><i class="fa fa-check"></i><b>2</b> The fundamentals of writing good code</a><ul>
<li class="chapter" data-level="2.1" data-path="the-fundamentals-of-writing-good-code.html"><a href="the-fundamentals-of-writing-good-code.html#why-writing-good-code-is-so-important"><i class="fa fa-check"></i><b>2.1</b> Why writing good code is so important</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="fundamentals-how-to-write-good-code.html"><a href="fundamentals-how-to-write-good-code.html"><i class="fa fa-check"></i><b>3</b> Fundamentals: How to write good code</a></li>
<li class="chapter" data-level="4" data-path="fundamentals-what-good-code-looks-like.html"><a href="fundamentals-what-good-code-looks-like.html"><i class="fa fa-check"></i><b>4</b> Fundamentals: What good code looks like</a><ul>
<li class="chapter" data-level="4.1" data-path="fundamentals-what-good-code-looks-like.html"><a href="fundamentals-what-good-code-looks-like.html#a-clear-and-informative-header"><i class="fa fa-check"></i><b>4.1</b> A clear and informative Header</a></li>
<li class="chapter" data-level="4.2" data-path="fundamentals-what-good-code-looks-like.html"><a href="fundamentals-what-good-code-looks-like.html#consistent-use-of-indentation"><i class="fa fa-check"></i><b>4.2</b> Consistent use of indentation</a></li>
<li class="chapter" data-level="4.3" data-path="fundamentals-what-good-code-looks-like.html"><a href="fundamentals-what-good-code-looks-like.html#descriptive-use-of-variable-names"><i class="fa fa-check"></i><b>4.3</b> Descriptive use of variable names</a></li>
<li class="chapter" data-level="4.4" data-path="fundamentals-what-good-code-looks-like.html"><a href="fundamentals-what-good-code-looks-like.html#descriptive-and-informative-comments"><i class="fa fa-check"></i><b>4.4</b> Descriptive and informative comments</a></li>
<li class="chapter" data-level="4.5" data-path="fundamentals-what-good-code-looks-like.html"><a href="fundamentals-what-good-code-looks-like.html#a-clear-flow-and-structure"><i class="fa fa-check"></i><b>4.5</b> A clear flow and structure</a></li>
<li class="chapter" data-level="4.6" data-path="fundamentals-what-good-code-looks-like.html"><a href="fundamentals-what-good-code-looks-like.html#consistent-spacing"><i class="fa fa-check"></i><b>4.6</b> Consistent spacing</a></li>
<li class="chapter" data-level="4.7" data-path="fundamentals-what-good-code-looks-like.html"><a href="fundamentals-what-good-code-looks-like.html#if-required-the-use-of-functions-or-subroutines"><i class="fa fa-check"></i><b>4.7</b> If required, the use of functions or subroutines</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="code-structure.html"><a href="code-structure.html"><i class="fa fa-check"></i><b>5</b> Advanced: Optimising code structure</a></li>
<li class="chapter" data-level="6" data-path="testing.html"><a href="testing.html"><i class="fa fa-check"></i><b>6</b> Advanced: Testing code</a></li>
<li class="chapter" data-level="7" data-path="VC.html"><a href="VC.html"><i class="fa fa-check"></i><b>7</b> Advanced: Version control</a></li>
<li class="chapter" data-level="8" data-path="documenation.html"><a href="documenation.html"><i class="fa fa-check"></i><b>8</b> Advanced: Documentation</a><ul>
<li class="chapter" data-level="8.1" data-path="documenation.html"><a href="documenation.html#comments"><i class="fa fa-check"></i><b>8.1</b> Comments</a></li>
<li class="chapter" data-level="8.2" data-path="documenation.html"><a href="documenation.html#rmarkdown-file"><i class="fa fa-check"></i><b>8.2</b> Rmarkdown file</a></li>
<li class="chapter" data-level="8.3" data-path="documenation.html"><a href="documenation.html#packaging-your-analysis"><i class="fa fa-check"></i><b>8.3</b> Packaging your analysis</a></li>
<li class="chapter" data-level="8.4" data-path="documenation.html"><a href="documenation.html#a-word-on-package-version-and-dependency"><i class="fa fa-check"></i><b>8.4</b> A word on package version and dependency</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Annex-A.html"><a href="Annex-A.html"><i class="fa fa-check"></i><b>9</b> Annex A: Version Control</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Good code practice</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fundamentals-what-good-code-looks-like" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Fundamentals: What good code looks like</h1>
<p>There is no definitive style that determines if code is well written or not. There’s an excellent resource for styling R code here <a href="https://style.tidyverse.org/index.html" class="uri">https://style.tidyverse.org/index.html</a> and it’s worth noting that Rstudio comes with numerous functionalities designed to help with good code structure (see drop down menu in <code>Code</code>). But, there are several features that are consistently found in code, regardless of language, that follow the principles of good practice. Some of these are outlined in the examples below.</p>
<div id="a-clear-and-informative-header" class="section level2">
<h2><span class="header-section-number">4.1</span> A clear and informative Header</h2>
<p>A header should contain, at a minimum, enough information about the code to give the reader an understanding of the task the code is attempting to carry out. It should contain the details of the original author, as well as any subsequent authors, and the dates of any key events – such as the creation date, or the date of a major modification. Headers can also contain information about data sources, libraries or packages (including version) used, or notes on any assumptions that are made in the analysis.</p>
<pre><code>  # VIRTUAL COHORT Propensity Score Matching ANALYSIS – 2014 KS2    
  #
  # Written by:  Anne Analyst
  # On:        26/11/15
  # Last update: 31/12/15
  #
  # Aim:
  #  Using pupil characteristics to identify pupils in LA-maintained schools 
  #  that are similar to pupils in sponsored academies – here “similar” 
  #  means, “have a high propensity to be” – to do this analysis we will use
  #  Propensity Score Matching.
  #
  # Datasets: 2014 KS2 Data
  # This data has been constructed from various datasets on our SQL
  # server (school census, NPD, AcademiesAndSchoolOrganisation)
  #
  # Key Libraries:
  #  The PSM analysis uses the MatchIt library – Version 2.4-21
  #
  /////----------------------------------------------------------------\\\\\
  \\\\\----------------------------------------------------------------/////</code></pre>
</div>
<div id="consistent-use-of-indentation" class="section level2">
<h2><span class="header-section-number">4.2</span> Consistent use of indentation</h2>
<p>Indentation is an important mechanism that adds <em>structure and readability</em> to code. Just like you would use grammar – sentences and paragraphs – to improve the readability of your written communication, you can use indentation to improve your code. A large block of code with no structure is as unreadable as a large block of prose in a novel. (Note that in some languages [e.g. Python] indentation also has a functional purpose – your code will not run correctly if you do not get it right.)</p>
<p>Indentation allows the programmer to delineate which part of code a statement belongs to – for example, any code that is encapsulated by an If statement can be clearly marked by indenting the code:</p>
<pre><code>IF (condition is TRUE) THEN
        actions…
    …

    IF (condition2 is TRUE) THEN
          second set of actions…
      …
    END IF
END IF
</code></pre>
</div>
<div id="descriptive-use-of-variable-names" class="section level2">
<h2><span class="header-section-number">4.3</span> Descriptive use of variable names</h2>
<p>Variable names should be short but descriptive. E.g. <em>x1</em> is not really helpful in interpreting the role of the variable, but <em>AverageAgeMale</em> is much more helpful if the task is about looking at population dynamics. Use names that link with the subject matter of the task.</p>
<p>Generally, variable names should be nouns and functions names should be verbs. This isn’t always an easy thing to do!</p>
<p>Try to avoid using names that are already used in standard functions such as the <code>mean()</code> function in R.</p>
<p>Choose a consistent naming convention and stick with it: never mix your conventions.
There are several naming conventions in use, including:</p>
<ul>
<li>Use lowercase letters and separate words with underscores (called “snake case”). E.g. <code>country_of_birth</code></li>
<li>Use uppercase letters at the start of each word (called “camel case”). E.g. <code>CountryOfBirth</code></li>
<li>In certain languages, you can use spaces as separators and brackets as delineators e.g. <code>[Country of Birth]</code></li>
</ul>
<p>No one is better than any other – the point is to choose one and use it <em>consistently</em> in your code. If you are modifying someone else’s code that has already established a convention, <em>stick to that convention</em>, even if it isn’t the one you’d usually choose.</p>
</div>
<div id="descriptive-and-informative-comments" class="section level2">
<h2><span class="header-section-number">4.4</span> Descriptive and informative comments</h2>
<p>Use comments to explain the “why”. The “what” and “how” are usually implied by the code itself. An example of well commented code is given below, the comments explain the reasoning behind each operation and allow the reader to understand the context and purpose of the code.</p>
<pre><code># We need to identify which pupils are eligible for free school meals
#  so we create an FSM_flag that we can filter on. 
filtered_pupils &lt;- mutate(total_pupils,
                          FSM_flag = ifelse(earnings &lt;= criteria,
                                            1,
                                            0)) %&gt;%
    # We’re only interested in those pupils who are on working tax
    #  credits and have an FSM flag
                    filter(benefit == “WTC”, FSM_flag == 1) %&gt;%

    # The previous operations re-ordered our table so we need to 
    #  rearrange
                    arrange(age, academic_year)
        
# We want to put our table in a wide format so that we can plot 
#  some nice outputs
                    pupils_wide &lt;- spread(filtered_pupils, academic_year, benefit)</code></pre>
</div>
<div id="a-clear-flow-and-structure" class="section level2">
<h2><span class="header-section-number">4.5</span> A clear flow and structure</h2>
<p>Structure code in a logical order – if you can, break your code into chunks. This can make it much easier to follow. Try not to jump around when manipulating different variables/tables – do your data manipulation on one object and then move onto the next; merge and combine objects at a sensible time.</p>
<p>Strive to limit your code to a reasonable number of characters per line. Doing this means your code is easily readable on one page (remember that others may be working with a smaller view window than you), without the need for scrolling, and it can help to identify different input variables within nested functions.</p>
<p>It may be useful to use commented lines, with no text, to break up your file into easily readable chunks.</p>
<p>There’s even more detail on structure <a href="code-structure.html#code_structure">here</a>, and a good example of well-structured code is given below.
The script is split into 3 sections and clearly broken up.</p>
<pre><code># 1. Input variables ---------------------------------------------------
# =====================================================================-

# Input the folder name of outputs
folder &lt;- “2019-08-12”

# 2. Load data --------------------------------------------------------
# ====================================================================-
    
# Load the rates from the folder
    rates &lt;- read.csv(paste0(“Model_outputs/”, folder),
                  row.names = 1)

# Load regional codes
    regions &lt;- read.csv(“Inputs/Regional_codes.csv”)

# 3. Manipulate -------------------------------------------------------
# ====================================================================-

# Bind regional codes to rates
    regional_rates &lt;- merge(rates, regions)</code></pre>
</div>
<div id="consistent-spacing" class="section level2">
<h2><span class="header-section-number">4.6</span> Consistent spacing</h2>
<p>Use white space around code lines and operators. White space around code lines helps to break up the code into readable chunks (see previous section on flow and structure).</p>
<p>Most operators (==, +, -, &lt;-, etc.) should always be surrounded by spaces.</p>
<p>Place a space before and after () when used with <code>if</code>, <code>for</code> or <code>while</code> but never inside or outside parentheses of normal functions. Always put a white space after a comma, never before, just like in regular English.</p>
<p>An example of using spaces in the situations discussed above is given below:</p>
<pre><code># We want to slice a data table for an example to show the use of commas
fruit_table &lt;- food_table[2, 2:6]

# This is a generic if statement
if (fruit == “Orange”) {
    oranges &lt;- crates * crate_stock - wastage
    }</code></pre>
</div>
<div id="if-required-the-use-of-functions-or-subroutines" class="section level2">
<h2><span class="header-section-number">4.7</span> If required, the use of functions or subroutines</h2>
<p>You shouldn’t be repeatedly writing the same code: if you find yourself doing this, stop! It’s much more efficient to create a function or subroutine instead. By doing this you only need to quality assure the function once, rather than your repetitive code many times. It also means that any future changes need to be implemented only in one place rather than many, and can be more efficient for the code to run.</p>
<pre><code># Create a function for calculating the weighted average
weight_avg &lt;- function(year, year_grp) {
    
  # Arguments:
  #  year – academic year we’re interested in.
  #  year_grp – the NC year we’re interested in.
  
  # Get the total volumes from the stocks we’re using
  total_stocks &lt;- sum(filter(stocks, AY == year)$vol)
  
  # Isolate the flows we are going to be taking the weighted average 
  #  of
  flows &lt;- filter(prot_flows, NC_Year == year_grp, AY == year)
  
  # Matrix multiplication of stocks and flows, divided by total stocks
  #  to get weighted avg
  weight_avg &lt;- (as.matrix(filter(stocks, AY == year)$vol)) %*%
                  as.matrix(flows)) / 
                  total_stocks

}</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="fundamentals-how-to-write-good-code.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="code-structure.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
